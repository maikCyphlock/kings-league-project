---
import Container from '@components/Container.astro'
import TeamPlayerToSeeStats from '@components/TeamPlayerToSeeStats.astro'

import Layout from '@layouts/Layout.astro'
import { findPresidentBy } from '@services/presidents.js'
import { getAllTeams } from '@services/teams.js'

const ICON_NETWORK_MAPPING = ['instagram', 'tiktok', 'twitch', 'twitter', 'youtube']

const { id, name, imageWhite, presidentId, socialNetworks, players, color } = Astro.props
const { team, player } = Astro.props
const gradient = `bg-${id}`

const socialNetworksWithIcon = socialNetworks.map((href) => ({
	href,
	style: href.includes('tiktok') ? 'filter: invert(1);' : null,
	icon: ICON_NETWORK_MAPPING.find((key) => href.includes(key))
}))
const president = await findPresidentBy({ id: presidentId })

export async function getStaticPaths() {
	let teams = await getAllTeams()
	// teams = teams.filter((team) => id)
	return teams.map((team) => {
		return team.players.map((player) => {
			return {
				params: { team: team.id, player: player.id },
				props: { team: team.id, player: player, ...team }
			}
		})
	})
}
---

<Layout title={name}>
	<section class='bg-principal py-10 sm:py-20 sm:px-2'>
		<Container>
			<div
				class={`relative py-10 px-2 md:px-20 md:py-10 shadow-xl sm:rounded -mt-10 z-10 mb-40 ${gradient}`}
			>
				<section class='flex flex-col xl:flex-row justify-center pb-10'>
					<div class='flex flex-col'>
						<div class='flex flex-col xl:flex-row items-center mb-2'>
							<img
								class='w-56 h-56 object-contain aspect-square'
								src={imageWhite}
								alt={`Escudo del equipo ${name}`}
								decoding='async'
								fetchpriority='high'
							/>
							<div class='flex flex-col text-center gap-y-4'>
								<h1 class='font-title font-bold text-4xl md:text-6xl text-white'>{name}</h1>
								<ul class='flex flex-row justify-center xl:justify-start'>
									{
										socialNetworksWithIcon.map(({ href, icon, style }) => {
											return (
												<li>
													<a
														class='block transition hover:scale-150'
														href={href}
														target='_blank'
														rel='noopener norefferer'
														title={`${icon.charAt(0).toUpperCase() + icon.slice(1)}`}
													>
														<img
															class='w-8 h-8 brightness-[1000] aspect-square'
															src={`/logos/social/${icon}.svg`}
															style={style}
															alt={`${
																icon.charAt(0).toUpperCase() + icon.slice(1)
															} del equipo ${name}`}
															width='32'
															height='32'
															decoding='async'
															fetchpriority='high'
														/>
													</a>
												</li>
											)
										})
									}
								</ul>
							</div>
						</div>
						<div class='flex justify-center'>
							<div class='w-96 h-96'>
								<canvas class='rounded' id='myChart'></canvas>
							</div>
							<TeamPlayerToSeeStats title='jugadores' team={team} player={player} />
						</div>
						<div class='text-center'></div>
					</div>
				</section>

				<div
					class={'-z-10 absolute inset-0 opacity-5 bg-center bg-[size:250%] transition bg-inherit'}
					style={`background-image:url('${imageWhite}')`}
				>
				</div>
			</div>
		</Container>
	</section>
</Layout>

<script>
	import Chart from 'chart.js/auto'
	const ctx = document.getElementById('myChart')

	// eslint-disable-next-line no-new
	new Chart(ctx, {
		type: 'radar',
		data: {
			labels: ['VELOCIDAD', 'F√çSICO', 'TIRO', 'PASE', 'TALENTO', 'DEFENSA'],
			datasets: [
				{
					label: 'ESTADISTICA',
					data: [10, 70, 87, 69, 78, 73],
					borderWidth: 2
				}
			]
		},
		options: {
			plugins: {
				legend: {
					display: false
				}
			},
			scales: {
				r: {
					beginAtZero: true,
					grid: {
						color: 'white',
						borderWidth: 5
					},
					ticks: {
						display: false,
						color: 'rgb(22,255,0)',
						font: {
							size: 12
						},
						backdropColor: 'rgba(0,0,0,0)'
					},
					angleLines: {
						color: 'white'
					},
					pointLabels: {
						color: 'white',
						font: {
							size: 16
						}
					}
				}
			}
		}
	})
</script>
